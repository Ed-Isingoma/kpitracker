<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <p:dialog header="#{empty kpiFormDialog.model.id ? 'Create a New KPI' : 'Edit KPI'}"
              widgetVar="kpiDialogWidget"
              modal="true"
              resizable="false"
              closable="true"
              closeOnEscape="true"
              styleClass="w-full md:w-30rem">

        <h:form id="kpiDialogContent">
            <p:messages id="dialogMessages" showDetail="true" closable="true">
                <p:autoUpdate/>
            </p:messages>

            <div class="p-fluid formgrid grid mt-2">

                <div class="field col-12">
                    <p:outputLabel for="title" value="KPI Title"/>
                    <p:inputText id="title" value="#{kpiFormDialog.model.title}" required="true"
                                 requiredMessage="Title is required."/>
                </div>

                <div class="field col-12">
                    <p:outputLabel for="measure" value="Measure"/>
                    <p:inputTextarea id="measure" value="#{kpiFormDialog.model.measure}" rows="3"
                                     autoResize="false" placeholder="How is this KPI measured?"/>
                </div>

                <div class="field col-12">
                    <p:outputLabel for="goal" value="Parent Goal"/>
                    <p:selectOneMenu id="goal" value="#{kpiFormDialog.model.goal}" required="true"
                                     requiredMessage="A parent Goal is required." disabled="true">
                        <f:selectItem itemLabel="#{kpiFormDialog.model.goal.title}" itemValue="#{kpiFormDialog.model.goal}"/>
                        <f:converter converterId="omnifaces.SelectItemsConverter" />
                    </p:selectOneMenu>
                </div>

                <div class="field col-12">
                    <p:outputLabel for="owner" value="Owner"/>
                    <p:selectOneMenu id="owner" value="#{kpiFormDialog.model.owner}" required="true"
                                     requiredMessage="An Owner is required." filter="true" filterMatchMode="contains">
                        <f:selectItem itemLabel="Select Owner..." itemValue="#{null}" noSelectionOption="true"/>
                        <f:selectItems value="#{kpiFormDialog.allUsers}" var="user"
                                       itemLabel="#{user.username}" itemValue="#{user}"/>
                        <f:converter converterId="omnifaces.SelectItemsConverter" />
                    </p:selectOneMenu>
                </div>

                <div class="field col-12 md:col-6">
                    <p:outputLabel for="weight" value="Weight (%)"/>
                    <p:inputNumber id="weight" value="#{kpiFormDialog.model.weight}"
                                   minValue="0" maxValue="100" symbol=" %" symbolPosition="s"/>
                </div>
            </div>

            <div class="flex justify-content-end gap-2 mt-4">
                <p:commandButton value="Cancel" type="button" styleClass="ui-button-secondary"
                                 onclick="PF('kpiDialogWidget').hide()"/>

                <p:commandButton value="Save" icon="pi pi-check"
                                 actionListener="#{kpiFormDialog.save}"
                                 update="#{kpiFormDialog.updateTarget} :kpiDialogContent:dialogMessages"
                                 process="@form"
                                 oncomplete="if (!args.validationFailed) PF('kpiDialogWidget').hide();"/>
            </div>
        </h:form>
    </p:dialog>
</ui:composition>