<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/pages/californiatemplate/template.xhtml">

    <ui:define name="title">User Management</ui:define>
    <ui:define name="viewname">Users</ui:define>

    <ui:define name="content">
        <!-- Custom styles for a modern table look -->
        <style type="text/css">
            /* Remove borders from table cells for a cleaner look */
            .users-table .ui-datatable-thead > tr > th,
            .users-table .ui-datatable-tbody > tr > td {
                border: none !important;
            }

            /* Style the table header */
            .users-table .ui-datatable-thead > tr > th {
                background: var(--surface-b) !important;
                color: var(--text-color-secondary) !important;
                font-weight: 600;
                text-transform: uppercase;
                font-size: 0.875rem;
            }

            /* Add a subtle bottom border to header */
            .users-table .ui-datatable-thead {
                border-bottom: 1px solid var(--surface-d) !important;
            }

            /* Style for clickable rows */
            .clickable-rows .ui-datatable-data > tr {
                cursor: pointer;
                transition: background-color 0.2s, transform 0.2s;
            }

            .clickable-rows .ui-datatable-data > tr:hover {
                background-color: var(--surface-c) !important;
                transform: scale(1.01); /* Slightly enlarge row on hover */
                box-shadow: 0 4px 12px rgba(0,0,0,0.08);
                z-index: 1;
                position: relative;
            }
        </style>

        <h:form id="usersView">
            <!-- Header and Stat Cards -->
            <div class="p-grid">
                <div class="p-col-12">
                    <div class="p-d-flex p-jc-between p-ai-center p-mb-4">
                        <h2 class="p-m-0">User Management</h2>
                        <p:commandButton value="Add User" icon="pi pi-plus"
                                         styleClass="ui-button-success"
                                         rendered="#{componentRenderer.canManageUsers}"
                                         actionListener="#{userFormDialog.show}">
                            <f:setPropertyActionListener value="#{null}" target="#{userFormDialog.model}"/>
                            <p:ajax event="dialogReturn" listener="#{usersView.reloadFilterReset}" update="usersTable"/>
                        </p:commandButton>
                    </div>
                </div>

                <!-- Stat Cards -->
                <div class="p-col-12 p-md-6 p-lg-3">
                    <div class="card p-p-3">
                        <div class="p-d-flex p-jc-between">
                            <div>
                                <span class="p-text-secondary">Total Users</span>
                                <div class="p-text-bold p-text-xl">#{usersView.total}</div>
                            </div>
                            <div class="p-d-flex p-ai-center p-jc-center bg-blue-100" style="width:2.5rem;height:2.5rem; border-radius: 50%;">
                                <i class="pi pi-users p-text-xl text-blue-500"> </i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-col-12 p-md-6 p-lg-3">
                    <div class="card p-p-3">
                        <div class="p-d-flex p-jc-between">
                            <div>
                                <span class="p-text-secondary">Male</span>
                                <div class="p-text-bold p-text-xl">#{usersView.noMale}</div>
                            </div>
                            <div class="p-d-flex p-ai-center p-jc-center bg-green-100" style="width:2.5rem;height:2.5rem; border-radius: 50%;">
                                <i class="pi pi-user p-text-xl text-green-500"> </i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-col-12 p-md-6 p-lg-3">
                    <div class="card p-p-3">
                        <div class="p-d-flex p-jc-between">
                            <div>
                                <span class="p-text-secondary">Female</span>
                                <div class="p-text-bold p-text-xl">#{usersView.noFemale}</div>
                            </div>
                            <div class="p-d-flex p-ai-center p-jc-center bg-pink-100" style="width:2.5rem;height:2.5rem; border-radius: 50%;">
                                <i class="pi pi-user p-text-xl text-pink-500"> </i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-col-12 p-md-6 p-lg-3">
                    <div class="card p-p-3">
                        <div class="p-d-flex p-jc-between">
                            <div>
                                <span class="p-text-secondary">Unknown</span>
                                <div class="p-text-bold p-text-xl">#{usersView.noUnknown}</div>
                            </div>
                            <div class="p-d-flex p-ai-center p-jc-center bg-gray-100" style="width:2.5rem;height:2.5rem; border-radius: 50%;">
                                <i class="pi pi-question-circle p-text-xl text-gray-500"> </i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Table Card -->
            <div class="card">
                <p:toolbar style="margin-bottom: 1rem;">
                    <p:toolbarGroup>
                        <!-- Left side: Search Input -->
                        <span class="p-input-icon-left">
            <i class="pi pi-search pr-2"> </i>
            <p:inputText id="globalFilter" value="#{usersView.searchTerm}" placeholder="Search Users..." style="width: 250px;">
                <p:ajax event="keyup" listener="#{usersView.reloadFilterReset}" update="usersTable" delay="150"/>
            </p:inputText>
        </span>
                    </p:toolbarGroup>

                    <p:toolbarGroup align="right">
                        <!-- Right side: All Filters -->
                        <div class="p-d-flex p-ai-center p-flex-wrap p-jc-end">
                            <p:selectOneMenu id="departmentFilter" value="#{usersView.selectedDepartment}" converter="departmentConverter"
                                             filter="true" filterMatchMode="contains" placeholder="All Departments"
                                             styleClass="p-mr-2 p-mb-2" style="min-width: 12rem;">
                                <f:selectItem itemLabel="All Departments" itemValue="#{null}" noSelectionOption="true"/>
                                <f:selectItems value="#{usersView.departments}" var="dept" itemValue="#{dept}" itemLabel="#{dept.name}" />
                                <p:ajax event="change" update="usersTable" listener="#{usersView.reloadFilterReset()}"/>
                            </p:selectOneMenu>

                            <p:selectOneMenu id="teamFilter" value="#{usersView.selectedTeam}" converter="teamConverter"
                                             filter="true" filterMatchMode="contains" placeholder="All Teams"
                                             styleClass="p-mr-2 p-mb-2" style="min-width: 12rem;">
                                <f:selectItem itemLabel="All Teams" itemValue="#{null}" noSelectionOption="true"/>
                                <f:selectItems value="#{usersView.teams}" var="team" itemValue="#{team}" itemLabel="#{team.name}" />
                                <p:ajax event="change" update="usersTable" listener="#{usersView.reloadFilterReset()}"/>
                            </p:selectOneMenu>

                            <p:selectOneMenu id="roleFilter" value="#{usersView.selectedRole}" converter="roleConverter"
                                             filter="true" filterMatchMode="contains" placeholder="All Roles"
                                             styleClass="p-mr-2 p-mb-2" style="min-width: 12rem;">
                                <f:selectItem itemLabel="All Roles" itemValue="#{null}" noSelectionOption="true"/>
                                <f:selectItems value="#{usersView.roles}" var="role" itemValue="#{role}" itemLabel="#{role.name}" />
                                <p:ajax event="change" update="usersTable" listener="#{usersView.reloadFilterReset()}"/>
                            </p:selectOneMenu>

                            <p:selectOneMenu id="genders" value="#{usersView.selectedGender}" converter="genderConverter"
                                             placeholder="All Genders" styleClass="p-mr-2 p-mb-2" style="min-width: 10rem;">
                                <f:selectItem itemLabel="All Genders" itemValue="#{null}" noSelectionOption="true"/>
                                <f:selectItems value="#{usersView.genders}"/>
                                <p:ajax event="change" update="usersTable" listener="#{usersView.reloadFilterReset()}"/>
                            </p:selectOneMenu>

<!--                            <p:calendar placeholder="From Date" value="#{usersView.createdFrom}" navigator="true" pattern="dd MMM, yyyy" styleClass="p-mr-2 p-mb-2"/>-->

<!--                            <p:calendar placeholder="To Date" value="#{usersView.createdTo}" navigator="true" pattern="dd MMM, yyyy" styleClass="p-mr-2 p-mb-2"/>-->

                            <p:commandButton icon="pi pi-search" styleClass="ui-button-info p-mb-2"
                                             update="usersTable"
                                             actionListener="#{usersView.reloadFilterReset()}"/>
                        </div>
                    </p:toolbarGroup>
                </p:toolbar>
                <p:dataTable id="usersTable" var="model" value="#{usersView.dataModels}"
                             widgetVar="usersTableWidget"
                             paginator="true" lazy="true" rows="10"
                             rowKey="#{model.id}"
                             emptyMessage="#{usersView.dataEmptyMessage}"
                             paginatorPosition="bottom"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,20,50"
                             selectionMode="single"
                             selection="#{usersView.selectedUser}"
                             styleClass="users-table clickable-rows">

                    <p:ajax event="rowSelect" listener="#{usersView.viewUserProfile}" />

                    <p:column headerText="User Info" sortBy="#{model.fullName}">
                        <div class="p-d-flex p-ai-center">
                            <p:graphicImage name="images/unnamed.png" library="california-layout" style="width:32px; height: 32px; border-radius: 50%; margin-right: 1rem;" />
                            <div>
                                <div class="p-text-bold">#{model.fullName}</div>
                                <div class="p-text-secondary">#{model.emailAddress}</div>
                            </div>
                        </div>
                    </p:column>

                    <p:column headerText="Department" sortBy="#{model.department.name}">
                        <h:outputText value="#{not empty model.department ? model.department.name : 'N/A'}"/>
                    </p:column>

                    <p:column headerText="Team" sortBy="#{model.team.name}">
                        <h:outputText value="#{not empty model.team ? model.team.name : 'N/A'}"/>
                    </p:column>

                    <p:column headerText="Roles">
                        <ui:repeat value="#{model.roles.toArray()}" var="role">
                            <p:tag value="#{role.name}" styleClass="p-mr-1" severity="info" rounded="true"/>
                        </ui:repeat>
                    </p:column>

                    <p:column headerText="Actions" style="width:8rem;text-align: center" exportable="false">
                        <p:commandButton icon="pi pi-pencil" title="Edit User"
                                         styleClass="p-button-text p-button-rounded p-button-info"
                                         rendered="#{componentRenderer.canManageUsers}"
                                         actionListener="#{usersView.userFormDialog.show}">
                            <f:setPropertyActionListener value="#{model}" target="#{userFormDialog.model}"/>
                            <p:ajax event="dialogReturn" update="usersTable"/>
                        </p:commandButton>

                        <p:commandButton icon="pi pi-trash" title="Delete User"
                                         styleClass="p-button-text p-button-rounded p-button-danger"
                                         rendered="#{componentRenderer.canManageUsers}"
                                         actionListener="#{usersView.deleteSelectedUser(model)}"
                                         update="usersView">
                            <p:confirm header="Confirmation"
                                       message="You are about to delete a user. Do you wish to continue?"
                                       icon="pi pi-exclamation-triangle"/>
                        </p:commandButton>
                    </p:column>

                </p:dataTable>
            </div>

            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" responsive="true" width="350">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" icon="pi pi-times" />
            </p:confirmDialog>

        </h:form>
    </ui:define>
</ui:composition>