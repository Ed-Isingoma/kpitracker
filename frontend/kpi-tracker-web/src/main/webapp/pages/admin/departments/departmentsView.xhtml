<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/pages/californiatemplate/template.xhtml">

    <ui:define name="title">Manage Departments</ui:define>
    <ui:define name="viewname">Departments</ui:define>

    <ui:define name="content">
        <style type="text/css">
            .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
            .page-title { font-size: 1.5rem; font-weight: 600; }
            .page-subtitle { color: #6c757d; }
            .department-grid-container .ui-dataview-content { border: none; background: transparent; }
            .department-card { background: #ffffff; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: all 0.2s ease-in-out; position: relative; margin-bottom: 1.5rem; }
            .department-card:hover { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
            .card-content { padding: 1.25rem; }
            .card-header-text { font-size: 1.1rem; font-weight: 600; color: #343a40; margin-bottom: 0.5rem; }
            .card-meta-text { font-size: 0.875rem; color: #6c757d; margin-bottom: 1.25rem; }
            .card-actions { border-top: 1px solid #e9ecef; padding: 0.75rem 1.25rem; display: flex; justify-content: space-between; align-items: center; }
            .card-edit-link { color: #007bff; text-decoration: none; font-weight: 500; font-size: 0.875rem; }
            .card-link-overlay { position: absolute; top:0; left:0; right:0; bottom: 60px; z-index: 1; }
        </style>

        <div class="card">
            <h:form id="departmentsForm">
                <p:growl id="growl" showDetail="true" />
                <div class="page-header">
                    <div>
                        <div class="page-title">Departments List</div>
                        <div class="page-subtitle">Manage all company departments</div>
                    </div>
                    <div class="p-d-flex p-ai-center">
                         <span class="ui-input-icon-left p-mr-2">
                            <i class="pi pi-search" />
                            <p:inputText value="#{departmentsView.searchTerm}" placeholder="Search..." >
                                <p:ajax event="keyup" update="departmentsDataView" />
                            </p:inputText>
                        </span>
                        <p:commandButton value="Add Department" icon="pi pi-plus" process="@this"
                                         actionListener="#{departmentFormDialog.resetModal()}"
                                         oncomplete="PF('departmentFormDialogWidget').show()"
                                         update=":departmentForm"/>
                    </div>
                </div>


                <p:dataView id="departmentsDataView" var="department" value="#{departmentsView}" lazy="true"
                            layout="grid" gridIcon="pi pi-th-large" listIcon="pi pi-bars"
                            paginator="true" rows="#{departmentsView.maximumresultsPerpage}"
                            paginatorPosition="bottom" emptyMessage="No departments found."
                            styleClass="department-grid-container">

                    <p:dataViewGridItem>
                        <div class="p-col-12 p-md-4">
                            <div class="department-card">
                                <div class="card-content">
                                    <div class="card-header-text">#{department.name}</div>
                                    <div class="card-meta-text">Total 12 Employees</div> <!-- Placeholder -->
                                    <div class="card-meta-text">Lead: #{department.departmentLead != null ? department.departmentLead.fullName : 'N/A'}</div>
                                </div>
                                <div class="card-actions">
                                    <p:commandButton value="Edit" styleClass="ui-button-text card-edit-link"
                                                     actionListener="#{departmentsView.departmentFormDialog.setModel(department)}"
                                                     oncomplete="PF('departmentFormDialogWidget').show()"
                                                     update=":departmentForm"/>

                                    <p:commandButton icon="pi pi-trash" title="Delete" styleClass="ui-button-text ui-button-danger"
                                                     actionListener="#{departmentsView.deleteDepartment(department)}"
                                                     update="@form">
                                        <p:confirm header="Confirmation" message="Are you sure you want to delete this department?" icon="pi pi-exclamation-triangle" />
                                    </p:commandButton>
                                </div>
                                <h:link outcome="/pages/admin/departments/departmentDetails.xhtml?faces-redirect=true" styleClass="card-link-overlay">
                                    <f:param name="id" value="#{department.id}"/>
                                </h:link>
                            </div>
                        </div>
                    </p:dataViewGridItem>
                </p:dataView>

                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" icon="pi pi-times" />
                </p:confirmDialog>
            </h:form>
        </div>

        <ui:include src="departmentForm.xhtml" />
    </ui:define>
</ui:composition>